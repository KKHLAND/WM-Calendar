<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í•™ì‚¬ì¼ì •</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD) - ì•ˆì •ì ì¸ ì‹¤í–‰ì„ ìœ„í•´ UMD ë°©ì‹ ìœ ì§€ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- date-fns (UMD) -->
    <script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/cdn.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    
    <style>
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-family: 'Inter', 'Noto Sans KR', sans-serif;
      }
      .grid-rows-auto {
        grid-auto-rows: minmax(100px, 1fr); 
      }
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>

    <script>
      if (typeof tailwind !== 'undefined') {
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
              },
            },
          },
        }
      }
      
      const processExcelFile = (file, callback, onError) => {
          const reader = new FileReader();
          reader.onload = (event) => {
              try {
                  const data = event.target.result;
                  const workbook = XLSX.read(data, { type: 'binary' });
                  const sheetName = workbook.SheetNames[0];
                  const worksheet = workbook.Sheets[sheetName];
                  const csv = XLSX.utils.sheet_to_csv(worksheet, { FS: ',', RS: '\n' });
                  callback(csv);
              } catch (e) {
                  onError("ì—‘ì…€ íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              }
          };
          reader.readAsBinaryString(file);
      };

      const processCsvFile = (file, callback, onError) => {
          const reader = new FileReader();
          reader.onload = (event) => {
              try {
                  let text = event.target.result;
                  if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
                  text = text.replace(/\r\n|\r/g, '\n');
                  callback(text);
              } catch (e) {
                  onError("CSV íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
              }
          };
          reader.readAsText(file);
      };
    </script>
</head>
<body class="bg-gradient-to-br from-sky-200 to-blue-100 p-2 sm:p-4 lg:p-8 min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
        const { useState, useMemo, useCallback, useEffect } = React;
        const {
            eachDayOfInterval,
            endOfMonth,
            endOfWeek,
            format,
            isSameMonth,
            isToday,
            startOfMonth,
            startOfWeek: dateFnsStartOfWeek
        } = dateFns;

        // --- ë°ì´í„° ê´€ë¦¬ ë§¤ë‹ˆì € ---
        const StorageManager = {
            saveEvents: (csv) => localStorage.setItem('schoolEvents', csv),
            saveHolidays: (csv) => localStorage.setItem('schoolHolidays', csv),
            saveSpecialEvents: (csv) => localStorage.setItem('schoolSpecialEvents', csv),
            saveSchoolName: (name) => localStorage.setItem('schoolName', name),
            saveLogo: (logoData) => localStorage.setItem('schoolLogo', logoData),
            
            saveManualData: (data) => localStorage.setItem('schoolManualData', JSON.stringify(data)),
            getManualData: () => {
                const data = localStorage.getItem('schoolManualData');
                return data ? JSON.parse(data) : {};
            },

            getEvents: () => localStorage.getItem('schoolEvents'),
            getHolidays: () => localStorage.getItem('schoolHolidays'),
            getSpecialEvents: () => localStorage.getItem('schoolSpecialEvents'),
            getSchoolName: () => localStorage.getItem('schoolName'),
            getLogo: () => localStorage.getItem('schoolLogo'),
            
            clearData: () => {
                localStorage.removeItem('schoolEvents');
                localStorage.removeItem('schoolHolidays');
                localStorage.removeItem('schoolSpecialEvents');
                localStorage.removeItem('schoolName');
                localStorage.removeItem('schoolLogo');
                localStorage.removeItem('schoolManualData');
            }
        };

        const DEFAULT_SCHOOL_NAME = 'ì›ë¬µê³ ë“±í•™êµ';
        const DEFAULT_LOGO_DATA_URL = 'https://i.imgur.com/6ZCUaap.jpeg';
        
        // ë‚´ì¥ ë°ì´í„°
        const rawEventsCsv = `"ë‚ ì§œ","í–‰ì‚¬1","í–‰ì‚¬2","í–‰ì‚¬3"
"2026. 2. 11","ì‹ í•™ë…„ëŒ€ë¹„ì§‘ì¤‘ì—°ìˆ˜","í•™êµë¡œì°¾ì•„ì˜¤ëŠ” ì»¨ì„¤íŒ… AI ì—°ìˆ˜",""
"2026. 2. 12","ì‹ í•™ë…„ëŒ€ë¹„ì§‘ì¤‘ì—°ìˆ˜","í•™êµë¡œì°¾ì•„ì˜¤ëŠ” ì»¨ì„¤íŒ… AI ì—°ìˆ˜",""
"2026. 2. 13","ì‹ í•™ë…„ëŒ€ë¹„ì§‘ì¤‘ì—°ìˆ˜","ì‹ ì…ìƒ ì˜ˆë¹„ì†Œì§‘ ë° ì‚¬ì „ êµìœ¡(ì˜¤ì „)","ë¶€ì„œë³„ êµê³¼ë³„ ììœ¨ì—°ìˆ˜(ì˜¤í›„)"
"2026. 2. 19","ì…í•™ì „ ë°°ì • ë“±ë¡","",""
"2026. 3. 3","ê°œí•™ì‹(2,3)","ì…í•™ì‹(1)",""
"2026. 3. 4","ììœ¨(ìƒê²¬ë¡€/OT(1))","ìƒí™œì•ˆì „êµìœ¡(2,3)",""
"2026. 3. 6","ììœ¨","ì „êµì§ì›íšŒì˜1",""
"2026. 3. 13","ììœ¨","",""
"2026. 3. 20","ë™ì•„ë¦¬","",""
"2026. 3. 23","í•™ë¶€ëª¨ì´íšŒ","1í•™ê¸°ìˆ˜ì—…ê³µê°œì˜ë‚ (5,6êµì‹œ)",""
"2026. 3. 24","í•™ë ¥í‰ê°€(1,2,3)","",""
"2026. 3. 25","êµì›í•™ìŠµê³µë™ì²´1","",""
"2026. 3. 27","ììœ¨","",""
"2026. 3. 30","ì°½ì˜ìƒìƒ ì¸ë¬¸ ê¸°ì´ˆ1","",""
"2026. 4. 1","ë³´ê³ ì„œ ì‘ì„±ë²• íŠ¹ê°•","",""
"2026. 4. 3","ë´‰ì‚¬í™œë™ ì‚¬ì „êµìœ¡","ì „êµì§ì›íšŒì˜2",""
"2026. 4. 6","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì •ê·œ1","",""
"2026. 4. 8","ì´ê³µê³„ì „ë¬¸ê°€ ì´ˆì²­íŠ¹ê°•1","",""
"2026. 4. 9","í™”ìš”ì¼ ìˆ˜ì—…","",""
"2026. 4. 10","í•™ìƒíšŒì¥ ì„ ê±°","",""
"2026. 4. 17","ë™ì•„ë¦¬","",""
"2026. 4. 24","ì¤‘ê°„ê³ ì‚¬-êµê³¼í˜‘ì˜","",""
"2026. 4. 27","ì¤‘ê°„ê³ ì‚¬-ë¶€ì„œí˜‘ì˜","",""
"2026. 4. 28","ì¤‘ê°„ê³ ì‚¬-í•™ë…„í˜‘ì˜","",""
"2026. 4. 29","ì¤‘ê°„ê³ ì‚¬-êµì›í•™ìŠµê³µë™ì²´2","",""
"2026. 4. 30","ì¤‘ê°„ê³ ì‚¬","",""
"2026. 5. 6","í•™êµí˜„ì¥ì‹¤ìŠµ ì‹œì‘","ë¹„ê²½ìŸì‹ ë…ì„œ í† ë¡ ","STEAMì‹¤í—˜ë°˜1"
"2026. 5. 7","í•™ë ¥í‰ê°€(3)","",""
"2026. 5. 8","í•™ê¸‰ë³„ ë´‰ì‚¬í™œë™","ì°½ì˜ìƒìƒ ì¸ë¬¸ ê¸°ì´ˆ2","STEAMì‹¤í—˜ë°˜2"
"2026. 5. 9","ì°½ì˜ìƒìƒ ì—­ì‚¬ ë¬¸í™”ì²´í—˜","",""
"2026. 5. 11","STEAMì‹¤í—˜ë°˜3","",""
"2026. 5. 13","STEAMì‹¤í—˜ë°˜4","",""
"2026. 5. 15","ì²´ìœ¡í•œë§ˆë‹¹","ë¬¸í™”ì²´í—˜(3)",""
"2026. 5. 18","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì •ê·œ2","STEAMì‹¤í—˜ë°˜5",""
"2026. 5. 20","ë…ì„œë©˜í† ë§ ì „ì²´ í† ë¡ ì¼","",""
"2026. 5. 22","ë™ì•„ë¦¬","STEAMì‹¤í—˜ë°˜6",""
"2026. 5. 25","ëŒ€ì²´ê³µíœ´ì¼","",""
"2026. 5. 27","êµì›í•™ìŠµê³µë™ì²´3","",""
"2026. 5. 29","ììœ¨","",""
"2026. 6. 1","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì •ê·œ3","",""
"2026. 6. 4","í•™ë ¥í‰ê°€(1,2)","ëŒ€ìˆ˜ëŠ¥ ëª¨í‰(3)",""
"2026. 6. 5","ë™ì•„ë¦¬","",""
"2026. 6. 8","STEAMì‹¤í—˜ë°˜ ë°œí‘œíšŒ","",""
"2026. 6. 10","ì§€ë…í•œ ë…ì„œí´ëŸ½ ì „ì²´ í† ë¡ ì¼","",""
"2026. 6. 12","ììœ¨","ì „êµì§ì›íšŒì˜3",""
"2026. 6. 19","ë™ì•„ë¦¬","",""
"2026. 6. 26","ììœ¨","",""
"2026. 6. 30","ê¸°ë§ê³ ì‚¬","",""
"2026. 7. 1","ê¸°ë§ê³ ì‚¬-êµê³¼í˜‘ì˜","",""
"2026. 7. 2","ê¸°ë§ê³ ì‚¬-ë¶€ì„œí˜‘ì˜","",""
"2026. 7. 3","ê¸°ë§ê³ ì‚¬-í•™ë…„í˜‘ì˜","",""
"2026. 7. 6","ê¸°ë§ê³ ì‚¬","êµì›í•™ìŠµê³µë™ì²´4",""
"2026. 7. 7","ì„ íƒê³¼ëª©ì„¤ëª…íšŒ","",""
"2026. 7. 8","í•™ë ¥í‰ê°€(3)","",""
"2026. 7. 10","ììœ¨","ìµœì„±ë³´ ì •ì„œì  ì§€ì› êµìœ¡(ì½˜ì„œíŠ¸)","ê²½ì œí•™ íŠ¹ê°•"
"2026. 7. 13","ìµœì„±ë³´ ì •ì„œì  ì§€ì› êµìœ¡(íŠ¹ê°•)","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì •ê·œ4",""
"2026. 7. 15","ê²½ì œí•™ íŠ¹ê°•","",""
"2026. 7. 16","ìµœì„±ë³´ ë³´ì¶©ì§€ë„ OT","",""
"2026. 7. 20","ì˜ˆìˆ êµìœ¡ë°œí‘œíšŒ","ì „êµì§ì›íšŒì˜4","ë°©í•™ì‹"
"2026. 7. 21","ê³¼í•™ì‹¤í—˜ìº í”„","",""
"2026. 7. 22","4ì°¨ì‚°ì—…ê³µí•™ìº í”„","",""
"2026. 8. 13","<ê°œí•™>","",""
"2026. 8. 14","ë™ì•„ë¦¬","ì „êµì§ì›íšŒì˜5",""
"2026. 8. 19","ê³¼í•™í† ë¡ ë§ˆë‹¹","ë…¼ì œë°œí‘œì¼",""
"2026. 8. 21","ë™ì•„ë¦¬","",""
"2026. 8. 24","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì •ê·œ5","",""
"2026. 8. 26","ê³¼í•™í† ë¡ ë§ˆë‹¹","ì°¸ê°€ ì‹ ì²­ ë§ˆê°ì¼","êµì›í•™ìŠµê³µë™ì²´5"
"2026. 8. 27","ê¸ˆìš”ì¼ ìˆ˜ì—…","(ë™3)",""
"2026. 8. 28","ë¬µí–¥ì œ","",""
"2026. 9. 2","í•™ë ¥í‰ê°€(1,2)","ëŒ€ìˆ˜ëŠ¥ ëª¨í‰(3)",""
"2026. 9. 4","êµìœ¡ê³¼ì •ë°•ëŒíšŒ","ê³¼í•™í† ë¡ ë§ˆë‹¹","ê°œìš”ì„œì œì¶œ(ì˜ˆì„ )"
"2026. 9. 9","ë…ì„œë©˜í† ë§ ì „ì²´ í† ë¡ ì¼","",""
"2026. 9. 11","í•™ê¸‰ë³„ ë´‰ì‚¬í™œë™","",""
"2026. 9. 16","ê³¼í•™í† ë¡ ë§ˆë‹¹(ë³¸ì„ )","",""
"2026. 9. 18","ììœ¨","ì „êµì§ì›íšŒì˜6",""
"2026. 9. 22","ëª©ìš”ì¼ ìˆ˜ì—…","",""
"2026. 9. 23","ê³¼í•™í† ë¡ ë§ˆë‹¹(ê²°ì„ )","",""
"2026. 10. 1","ì¤‘ê°„ê³ ì‚¬-êµê³¼í˜‘ì˜","",""
"2026. 10. 2","ì¤‘ê°„ê³ ì‚¬-ë¶€ì„œí˜‘ì˜","",""
"2026. 10. 6","ì¤‘ê°„ê³ ì‚¬-í•™ë…„í˜‘ì˜","",""
"2026. 10. 7","ì¤‘ê°„ê³ ì‚¬","êµì›í•™ìŠµê³µë™ì²´6",""
"2026. 10. 8","ì¤‘ê°„ê³ ì‚¬","",""
"2026. 10. 14","ìˆ˜ë ¨íšŒ(1)","ì¼ì¼í˜• ì²´í—˜í™œë™(2)",""
"2026. 10. 15","ìˆ˜ë ¨íšŒ(1)","ì¼ì¼í˜• ì²´í—˜í™œë™(2)",""
"2026. 10. 16","ìˆ˜ë ¨íšŒ(1)","ì¼ì¼í˜• ì²´í—˜í™œë™(2)","ììœ¨(3)"
"2026. 10. 20","í•™ë ¥í‰ê°€(1,2,3)","",""
"2026. 10. 21","ì§€ë…í•œ ë…ì„œí´ëŸ½ í† ë¡ ì¼","",""
"2026. 10. 23","ë™ì•„ë¦¬","ë…ë„ì˜ ë‚  í–‰ì‚¬",""
"2026. 10. 24","ìˆ˜í•™ì°½ì˜ë ¥ìº í”„","",""
"2026. 10. 26","ì¸ë¬¸íƒêµ¬ ë°œí‘œ","ìˆ˜ì •ì›ê³  ë§ˆê°",""
"2026. 10. 28","ì´ê³µê³„ì „ë¬¸ê°€","ì´ˆì²­íŠ¹ê°•2",""
"2026. 10. 30","ììœ¨","",""
"2026. 11. 2","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì •ê·œ6","(ì¸ë¬¸íƒêµ¬ ë°œí‘œ)",""
"2026. 11. 6","ììœ¨","ìœµí•© ë…ì„œìº í”„",""
"2026. 11. 7","ì²œë¬¸ìš°ì£¼ìº í”„","",""
"2026. 11. 9","ì°½ì˜ìƒìƒ ì¸ë¬¸ ì˜ˆë¹„ì¼","(ì¸ë¬¸íƒêµ¬ ë°œí‘œ)",""
"2026. 11. 13","ììœ¨","",""
"2026. 11. 19","ëŒ€í•™ìˆ˜í•™ëŠ¥ë ¥ì‹œí—˜(3)","íœ´ì—…ì¼(1,2)",""
"2026. 11. 20","ì¬ëŸ‰íœ´ì—…ì¼","",""
"2026. 11. 23","ê¸ˆìš”ì¼ ìˆ˜ì—…","",""
"2026. 11. 25","êµì›í•™ìŠµê³µë™ì²´7","",""
"2026. 11. 27","ììœ¨","ì „êµì§ì›íšŒì˜7",""
"2026. 12. 1","ëª©ìš”ì¼ ìˆ˜ì—…","",""
"2026. 12. 4","ììœ¨","",""
"2026. 12. 10","ê¸°ë§ê³ ì‚¬(1,2)-êµê³¼í˜‘ì˜","",""
"2026. 12. 11","ììœ¨(3)","ê¸°ë§ê³ ì‚¬(1,2)-ë¶€ì„œí˜‘ì˜",""
"2026. 12. 14","ê¸°ë§ê³ ì‚¬(1,2)-í•™ë…„í˜‘ì˜","",""
"2026. 12. 15","ê¸°ë§ê³ ì‚¬(1,2)","",""
"2026. 12. 16","ê¸°ë§ê³ ì‚¬(1,2)","",""
"2026. 12. 18","*ìµœì„±ë³´ ì •ì„œì  ì§€ì› êµìœ¡(ê³¨ë“ ë²¨)","",""
"2026. 12. 23","*ìµœì„±ë³´ ì •ì„œì  ì§€ì› êµìœ¡(ì½˜ì„œíŠ¸)","êµì›í•™ìŠµê³µë™ì²´ 8",""
"2026. 12. 24","ì™¸êµ­ì–´ ë…¸ë˜ì œ","",""
"2026. 12. 28","*ìµœì„±ë³´ ë³´ì¶©ì§€ë„ OT","ë¼ìë‘",""
"2026. 12. 29","ì˜ˆìˆ êµìœ¡ë°œí‘œíšŒ","",""
"2026. 12. 30","ì „êµì§ì›íšŒì˜8","(3í•™ë…„ ì¡¸ì—…ì‚¬ì •ì•ˆ)","<ë°©í•™ì‹>"
"2027. 2. 1","<ê°œí•™>","",""
"2027. 2. 3","ì¡¸ì—…ì‹(3)","",""
"2027. 2. 4","<ì¢…ì—…ì‹(1,2)>","",""
"2027. 2. 16","ì‹ í•™ë…„ëŒ€ë¹„ì§‘ì¤‘ì—°ìˆ˜","",""
"2027. 2. 17","ì‹ í•™ë…„ëŒ€ë¹„ì§‘ì¤‘ì—°ìˆ˜","",""
"2027. 2. 18","ì‹ í•™ë…„ëŒ€ë¹„ì§‘ì¤‘ì—°ìˆ˜","",""
"2027. 2. 19","ë¶€ì¥ê¸°íšì›Œí¬ìˆ? -","",""
`;

        const rawHolidaysCsv = `"ë‚ ì§œ","íœ´ì¼"
"2026-01-01","ì‹ ì •(ì–‘ë ¥ì„¤)"
"2026-02-16","ì„¤ë‚  ì—°íœ´"
"2026-02-17","ì„¤ë‚ "
"2026-02-18","ì„¤ë‚  ì—°íœ´"
"2026-03-01","3Â·1ì ˆ"
"2026-03-02","ëŒ€ì²´ê³µíœ´ì¼(3Â·1ì ˆ)"
"2026-05-05","ì–´ë¦°ì´ë‚ "
"2026-05-01","ì¬ëŸ‰íœ´ì—…ì¼"
"2026-05-04","ì¬ëŸ‰íœ´ì—…ì¼"
"2026-05-24","ë¶€ì²˜ë‹˜ ì˜¤ì‹ ë‚ "
"2026-05-25","ëŒ€ì²´ê³µíœ´ì¼(ë¶€ì²˜ë‹˜ ì˜¤ì‹ ë‚ )"
"2026-06-03","ì§€ë°©ì„ ê±°ì¼"
"2026-06-06","í˜„ì¶©ì¼"
"2026-07-17","ì œí—Œì ˆ"
"2026-08-15","ê´‘ë³µì ˆ"
"2026-08-17","ëŒ€ì²´ê³µíœ´ì¼(ê´‘ë³µì ˆ)"
"2026-09-24","ì¶”ì„ ì—°íœ´"
"2026-09-25","ì¶”ì„"
"2026-09-26","ì¶”ì„ ì—°íœ´"
"2026-10-03","ê°œì²œì ˆ"
"2026-10-05","ëŒ€ì²´ê³µíœ´ì¼(ê°œì²œì ˆ)"
"2026-10-09","í•œê¸€ë‚ "
"2026-12-25","í¬ë¦¬ìŠ¤ë§ˆìŠ¤"
"2027-01-01","ì‹ ì •(ì–‘ë ¥ì„¤)"
"2027-02-06","ì„¤ë‚  ì—°íœ´"
"2027-02-07","ì„¤ë‚ "
"2027-02-08","ì„¤ë‚  ì—°íœ´"
"2027-02-09","ëŒ€ì²´ê³µíœ´ì¼(ì„¤ë‚ )"
`;

        const rawDutiesCsv = `"ë‚ ì§œ","ìš”ì¼","ì§€ë„êµì‚¬","ì¢…ë¥˜","ë¹„ê³ "
"2026. 3. 2","ì›”","ê¹€**","íœ´ì¼ê·¼ë¬´","ëŒ€ì²´ê³µíœ´ì¼(3Â·1ì ˆ)"
`;

        // --- ìœ í‹¸ë¦¬í‹° ---
        const parseDate = (dateStr) => {
            if (!dateStr) return null;
            let cleanedStr = dateStr.replace(/\./g, '-').replace(/\s/g, '');
            let parts = cleanedStr.split('-').filter(p => p);
            if (parts.length === 3) {
                const [y, m, d] = parts.map(p => parseInt(p, 10));
                if (!isNaN(y) && y > 1900) return new Date(y, m - 1, d);
            }
            const date = new Date(dateStr);
            return (date instanceof Date && !isNaN(date)) ? date : null;
        };

        const formatDateKey = (date) => {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        };

        const parseCsvLine = (line) => {
            const fields = [];
            let currentField = '';
            let inQuotes = false;
            for (const char of line) {
                if (char === '"') inQuotes = !inQuotes;
                else if (char === ',' && !inQuotes) {
                    fields.push(currentField.trim());
                    currentField = '';
                } else currentField += char;
            }
            fields.push(currentField.trim());
            return fields.map(f => f.replace(/^"|"$/g, ''));
        };

        const EVENT_COLORS = [
            { bg: 'bg-sky-100', text: 'text-sky-900' },
            { bg: 'bg-emerald-100', text: 'text-emerald-900' },
            { bg: 'bg-amber-100', text: 'text-amber-900' },
            { bg: 'bg-violet-100', text: 'text-violet-900' },
            { bg: 'bg-rose-100', text: 'text-rose-900' },
            { bg: 'bg-indigo-500', text: 'text-white' },
            { bg: 'bg-emerald-600', text: 'text-white' }
        ];

        const getEventColor = (eventTitle) => {
            if (!eventTitle) return 'bg-slate-100 text-slate-700';
            const activityKeywords = ['ììœ¨', 'ì ì‘', 'ë™ì•„ë¦¬', 'ë´‰ì‚¬'];
            for (const keyword of activityKeywords) if (eventTitle.includes(keyword)) return 'bg-teal-500 text-white';
            const specialKeywords = {
                'ê³ ì‚¬': 'bg-red-500 text-white font-bold',
                'í‰ê°€': 'bg-red-500 text-white font-bold',
                'ì‹œí—˜': 'bg-red-500 text-white font-bold',
                'ë°©í•™': 'bg-blue-500 text-white',
                'ê°œí•™': 'bg-blue-500 text-white',
                'ì¡¸ì—…': 'bg-purple-500 text-white',
                'ì…í•™': 'bg-purple-500 text-white',
            };
            for (const keyword in specialKeywords) if (eventTitle.includes(keyword)) return specialKeywords[keyword];
            const themedKeywords = [
                { keywords: ['ì¸ë¬¸', 'ë…ì„œ'], color: 'bg-purple-600 text-white' },
                { keywords: ['ê³¼í•™'], color: 'bg-blue-600 text-white' },
                { keywords: ['ì˜ˆìˆ ', 'ë¯¸ìˆ ', 'ìŒì•…'], color: 'bg-rose-500 text-white' },
                { keywords: ['ì²´ìœ¡', 'ìŠ¤í¬ì¸ '], color: 'bg-lime-600 text-white' },
                { keywords: ['êµì›', 'êµì§ì›íšŒì˜', 'ì—°ìˆ˜', 'í˜‘ì˜íšŒ'], color: 'bg-yellow-500 text-white' }
            ];
            for (const theme of themedKeywords) {
                for (const keyword of theme.keywords) if (eventTitle.includes(keyword)) return theme.color;
            }
            const hash = eventTitle.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const color = EVENT_COLORS[hash % EVENT_COLORS.length];
            return `${color.bg} ${color.text}`;
        };

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
        const ChevronLeftIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" /></svg>
        );
        const ChevronRightIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" /></svg>
        );
        const XMarkIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        );

        // --- ì»´í¬ë„ŒíŠ¸: MiniCalendar (ìš”ì¼/ê³µíœ´ì¼ ìƒ‰ìƒ ì ìš©) ---
        const MiniCalendar = ({ date, startOfWeek, dayDataMap }) => {
            const monthStart = startOfMonth(date);
            const calendarStart = dateFnsStartOfWeek(monthStart, { weekStartsOn: startOfWeek });
            const calendarEnd = endOfWeek(endOfMonth(monthStart), { weekStartsOn: startOfWeek });
            const days = eachDayOfInterval({ start: calendarStart, end: calendarEnd });
            let dayHeaders = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            if (startOfWeek === 1) dayHeaders.push(dayHeaders.shift());

            return (
                <div className="w-48">
                    <h3 className="text-center font-semibold text-sm mb-2 text-slate-700">{format(date, 'MMMM yyyy')}</h3>
                    <div className="grid grid-cols-7 text-center text-[10px] text-slate-500">
                        {dayHeaders.map((day, idx) => {
                            let headerColor = "text-slate-500";
                            const realIdx = startOfWeek === 0 ? idx : (idx + 1) % 7;
                            if (realIdx === 0) headerColor = "text-red-500";
                            if (realIdx === 6) headerColor = "text-blue-500";
                            return <div key={idx} className={`h-4 flex items-center justify-center font-bold ${headerColor}`}>{day}</div>;
                        })}
                    </div>
                    <div className="grid grid-cols-7 text-center text-[10px] mt-1">
                        {days.map(day => {
                            const dateKey = formatDateKey(day);
                            const hasHoliday = dayDataMap && dayDataMap.get(dateKey)?.holiday;
                            const isCurrentMonth = isSameMonth(day, date);
                            
                            let dateColor = isCurrentMonth ? 'text-slate-600' : 'text-slate-300';
                            if (isCurrentMonth) {
                                if (day.getDay() === 0 || hasHoliday) dateColor = 'text-red-500 font-medium';
                                else if (day.getDay() === 6) dateColor = 'text-blue-500 font-medium';
                            }

                            return (
                                <div key={day.toString()} className={`w-6 h-5 flex items-center justify-center rounded-full ${isToday(day) ? 'bg-blue-600 text-white font-bold' : dateColor}`}>
                                    {format(day, 'd')}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- ì»´í¬ë„ŒíŠ¸: EventModal ---
        const EventModal = ({ dayData, onClose, onUpdate }) => {
            const { date, events, holiday, teacherDuty } = dayData;
            const dateKey = formatDateKey(date);
            const [editEvents, setEditEvents] = useState(events.map(e => e.fullTitle));
            const [editHoliday, setEditHoliday] = useState(holiday ? holiday.name : '');
            const [editTeacher, setEditTeacher] = useState(teacherDuty ? teacherDuty.teacher : '');
            const [newEvent, setNewEvent] = useState('');

            const handleSave = () => {
                onUpdate(dateKey, {
                    events: editEvents,
                    holiday: editHoliday ? { name: editHoliday, date } : null,
                    teacherDuty: editTeacher ? { teacher: editTeacher, date } : null
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex justify-center items-center p-4 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col" onClick={e => e.stopPropagation()}>
                        <header className="p-4 border-b flex justify-between items-center bg-slate-50">
                            <h2 className="text-lg font-bold text-slate-800">{format(date, 'yyyyë…„ MMì›” ddì¼')}</h2>
                            <button onClick={onClose} className="p-1 rounded-full text-slate-400 hover:bg-white"><XMarkIcon /></button>
                        </header>
                        <div className="p-5 overflow-y-auto max-h-[70vh] space-y-5">
                            <section>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-2 tracking-tight">í•™ì‚¬ ì¼ì • í¸ì§‘</label>
                                <div className="space-y-2 mb-3">
                                    {editEvents.map((ev, idx) => (
                                        <div key={idx} className="flex items-center gap-2 group">
                                            <div className={`flex-grow p-2 rounded-lg text-sm font-medium ${getEventColor(ev)}`}>{ev}</div>
                                            <button onClick={() => setEditEvents(editEvents.filter((_, i) => i !== idx))} className="text-red-400 hover:text-red-600 font-bold p-1">ì‚­ì œ</button>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-2">
                                    <input type="text" value={newEvent} onChange={e => setNewEvent(e.target.value)} placeholder="ìƒˆ ì¼ì • ì…ë ¥..." className="flex-grow border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500" onKeyPress={e => e.key === 'Enter' && newEvent.trim() && (setEditEvents([...editEvents, newEvent.trim()]), setNewEvent(''))} />
                                    <button onClick={() => { if(newEvent.trim()){ setEditEvents([...editEvents, newEvent.trim()]); setNewEvent(''); }}} className="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold">ì¶”ê°€</button>
                                </div>
                            </section>
                            <div className="grid grid-cols-2 gap-4">
                                <section>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">ê³µíœ´ì¼</label>
                                    <input type="text" value={editHoliday} onChange={e => setEditHoliday(e.target.value)} placeholder="ê³µíœ´ì¼ëª…" className="w-full border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-500" />
                                </section>
                                <section>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">êµì‚¬/í–‰ì‚¬</label>
                                    <input type="text" value={editTeacher} onChange={e => setEditTeacher(e.target.value)} placeholder="êµì‚¬ëª…" className="w-full border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-slate-500" />
                                </section>
                            </div>
                        </div>
                        <footer className="p-4 bg-slate-50 border-t flex gap-2 justify-end">
                            <button onClick={onClose} className="px-4 py-2 text-slate-600 font-bold hover:bg-slate-200 rounded-lg">ì·¨ì†Œ</button>
                            <button onClick={handleSave} className="px-5 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 shadow-md">ì €ì¥í•˜ê¸°</button>
                        </footer>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [rawEventsData, setRawEventsData] = useState('');
            const [rawHolidaysData, setRawHolidaysData] = useState('');
            const [rawDutiesData, setRawDutiesData] = useState('');
            const [manualData, setManualData] = useState({});
            const [schoolName, setSchoolName] = useState('');
            const [schoolLogo, setSchoolLogo] = useState(null);
            const [viewDate, setViewDate] = useState(new Date());
            const [startOfWeek, setStartOfWeek] = useState(0);
            const [selectedDay, setSelectedDay] = useState(null);
            const [showUploadModal, setShowUploadModal] = useState(false);

            useEffect(() => {
                const saved = StorageManager.getSchoolName();
                if (saved) {
                    setSchoolName(saved);
                    setSchoolLogo(StorageManager.getLogo());
                    setRawEventsData(StorageManager.getEvents() || '');
                    setRawHolidaysData(StorageManager.getHolidays() || '');
                    setRawDutiesData(StorageManager.getSpecialEvents() || '');
                    setManualData(StorageManager.getManualData());
                } else {
                    StorageManager.saveSchoolName(DEFAULT_SCHOOL_NAME);
                    StorageManager.saveLogo(DEFAULT_LOGO_DATA_URL);
                    StorageManager.saveEvents(rawEventsCsv);
                    StorageManager.saveHolidays(rawHolidaysCsv);
                    StorageManager.saveSpecialEvents(rawDutiesCsv);
                    setSchoolName(DEFAULT_SCHOOL_NAME);
                    setSchoolLogo(DEFAULT_LOGO_DATA_URL);
                    setRawEventsData(rawEventsCsv);
                    setRawHolidaysData(rawHolidaysCsv);
                    setRawDutiesData(rawDutiesCsv);
                }
            }, []);

            const calendarData = useMemo(() => {
                const dayDataMap = new Map();
                const parseCsv = (txt) => txt ? txt.trim().split('\n').slice(1).map(line => parseCsvLine(line)) : [];
                const baseEvents = parseCsv(rawEventsData);
                const baseHolidays = parseCsv(rawHolidaysData);
                const baseDuties = parseCsv(rawDutiesData);

                const addToMap = (date, content) => {
                    if (!date) return;
                    const key = formatDateKey(date);
                    if (!dayDataMap.has(key)) dayDataMap.set(key, { date, events: [], holiday: null, teacherDuty: null });
                    const target = dayDataMap.get(key);
                    if (content.events) content.events.forEach(e => target.events.push({ title: e, fullTitle: e, color: getEventColor(e) }));
                    if (content.holiday) target.holiday = content.holiday;
                    if (content.teacherDuty) target.teacherDuty = content.teacherDuty;
                };

                baseEvents.forEach(([d, ...evs]) => addToMap(parseDate(d), { events: evs.filter(e => e) }));
                baseHolidays.forEach(([d, n]) => addToMap(parseDate(d), { holiday: { name: n, date: parseDate(d) } }));
                baseDuties.forEach(([d, _y, t]) => addToMap(parseDate(d), { teacherDuty: { teacher: t, date: parseDate(d) } }));

                Object.entries(manualData).forEach(([key, data]) => {
                    if (!dayDataMap.has(key)) dayDataMap.set(key, { date: parseDate(key), events: [], holiday: null, teacherDuty: null });
                    const target = dayDataMap.get(key);
                    target.events = data.events.map(e => ({ title: e, fullTitle: e, color: getEventColor(e) }));
                    target.holiday = data.holiday;
                    target.teacherDuty = data.teacherDuty;
                });

                const multiDayEvents = [];
                const processedIds = new Set();
                const sortedKeys = Array.from(dayDataMap.keys()).sort();
                for (const key of sortedKeys) {
                    const day = dayDataMap.get(key);
                    for (const event of day.events) {
                        const id = `${key}_${event.fullTitle}`;
                        if (processedIds.has(id)) continue;
                        let end = new Date(day.date), next = new Date(day.date);
                        next.setDate(next.getDate() + 1);
                        let nKey = formatDateKey(next);
                        const currentRun = [id];
                        while (dayDataMap.has(nKey)) {
                            const ne = dayDataMap.get(nKey).events.find(e => e.fullTitle === event.fullTitle);
                            if (ne) { end = new Date(dayDataMap.get(nKey).date); currentRun.push(`${nKey}_${ne.fullTitle}`); }
                            else break;
                            next.setDate(next.getDate() + 1); nKey = formatDateKey(next);
                        }
                        if (end > day.date) {
                            multiDayEvents.push({ id: `${event.fullTitle}_${key}`, start: day.date, end, title: event.fullTitle, color: event.color, lane: 0 });
                            currentRun.forEach(i => processedIds.add(i));
                        }
                    }
                }
                multiDayEvents.sort((a,b) => a.start - b.start);
                const laneManaged = [];
                multiDayEvents.forEach(ev => {
                    let l = 0;
                    while(laneManaged.find(e => e.lane === l && !(ev.start > e.end || ev.end < e.start))) l++;
                    laneManaged.push({...ev, lane: l});
                });
                for (const [k, d] of dayDataMap.entries()) d.events = d.events.filter(e => !processedIds.has(`${k}_${e.fullTitle}`));
                return { dayDataMap, multiDayEvents: laneManaged };
            }, [rawEventsData, rawHolidaysData, rawDutiesData, manualData]);

            return (
                <div className="w-full max-w-7xl mx-auto bg-white rounded-2xl shadow-xl flex flex-col min-h-[85vh] overflow-hidden">
                    <header className="bg-white shadow-sm sticky top-0 z-20">
                        <div className="p-4 flex justify-between items-center gap-4">
                            <div className="hidden lg:block">
                                <MiniCalendar date={new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1)} startOfWeek={startOfWeek} dayDataMap={calendarData.dayDataMap} />
                            </div>
                            <div className="text-center p-6 rounded-xl shadow-lg bg-gradient-to-r from-sky-500 to-indigo-600 text-white select-none flex-grow">
                                <h1 className="text-2xl sm:text-3xl font-bold tracking-tight">ìŠ¤ë§ˆíŠ¸ ìŠ¤ì¿¨ ìº˜ë¦°ë”</h1>
                                <p className="text-sm sm:text-base mt-1 font-medium opacity-90">{schoolName ? schoolName + " " : ""}í•™ì‚¬ ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                            </div>
                            <div className="hidden lg:block">
                                <MiniCalendar date={new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1)} startOfWeek={startOfWeek} dayDataMap={calendarData.dayDataMap} />
                            </div>
                        </div>
                        <div className="p-3 border-t flex items-center justify-between flex-wrap gap-2">
                             <div className="flex items-center gap-3">
                                {schoolLogo ? <img src={schoolLogo} alt="Logo" className="h-10 object-contain" /> : <span className="text-2xl">ğŸ«</span>}
                                <button onClick={() => setViewDate(new Date())} className="px-4 py-2 bg-white border border-slate-300 rounded-md text-sm font-semibold hover:bg-slate-50 shadow-sm transition-all">ì˜¤ëŠ˜</button>
                             </div>
                             
                             <div className="flex items-center absolute left-1/2 -translate-x-1/2">
                                <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1))} className="p-2 rounded-full text-slate-400 hover:bg-slate-100"><ChevronLeftIcon /></button>
                                <h2 className="text-lg font-bold text-slate-800 w-36 text-center">{format(viewDate, 'yyyyë…„ MMì›”')}</h2>
                                <button onClick={() => setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1))} className="p-2 rounded-full text-slate-400 hover:bg-slate-100"><ChevronRightIcon /></button>
                             </div>

                             <div className="flex items-center gap-2">
                                <select value={startOfWeek} onChange={(e) => setStartOfWeek(Number(e.target.value))} className="text-sm border rounded-md px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value={0}>ì¼ìš”ì¼ ì‹œì‘</option>
                                    <option value={1}>ì›”ìš”ì¼ ì‹œì‘</option>
                                </select>
                                <button onClick={() => setShowUploadModal(true)} className="px-4 py-2 bg-blue-50 text-blue-700 text-sm font-bold border border-blue-200 rounded-md hover:bg-blue-100 transition-all">ë°ì´í„° ì„¤ì •</button>
                                <button onClick={() => { if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ StorageManager.clearData(); location.reload(); }}} className="px-4 py-2 bg-red-50 text-red-700 text-sm font-bold border border-red-200 rounded-md hover:bg-red-100 transition-all">ë°ì´í„° ì´ˆê¸°í™”</button>
                             </div>
                        </div>
                    </header>

                    <main className="flex-grow p-1 sm:p-2 lg:p-4 bg-slate-50 overflow-auto">
                        <CalendarBody viewDate={viewDate} startOfWeek={startOfWeek} calendarData={calendarData} onDayClick={setSelectedDay} />
                    </main>

                    {/* Footer ì¶”ê°€ */}
                    <footer className="p-4 bg-white border-t text-center text-slate-400 text-xs font-medium">
                        Â© 2025 KH KIM. All Rights Reserved.
                    </footer>

                    {selectedDay && <EventModal dayData={selectedDay} onClose={() => setSelectedDay(null)} onUpdate={(k, d) => { const n = { ...manualData, [k]: d }; setManualData(n); StorageManager.saveManualData(n); }} />}
                    {showUploadModal && <DataUploadModal onDataLoaded={(d) => { setSchoolName(d.schoolName); setRawEventsData(d.events); setRawHolidaysData(d.holidays); setRawDutiesData(d.specialEvents); setSchoolLogo(d.logo); setShowUploadModal(false); }} onClose={() => setShowUploadModal(false)} />}
                </div>
            );
        };

        const CalendarBody = ({ viewDate, startOfWeek, calendarData, onDayClick }) => {
            const year = viewDate.getFullYear(), month = viewDate.getMonth();
            const start = dateFnsStartOfWeek(new Date(year, month, 1), { weekStartsOn: startOfWeek });
            const end = endOfWeek(endOfMonth(new Date(year, month, 1)), { weekStartsOn: startOfWeek });
            const days = eachDayOfInterval({ start, end });
            const weeks = [];
            for (let i = 0; i < days.length; i += 7) weeks.push(days.slice(i, i + 7));
            const dayHeaders = startOfWeek === 0 ? ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '] : ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];

            return (
                <div className="border-t border-l border-slate-300 bg-white flex flex-col shadow-lg rounded-xl overflow-hidden">
                    <div className="grid grid-cols-7">
                        {dayHeaders.map(h => <div key={h} className="bg-blue-600 text-white text-center py-2.5 text-sm font-bold border-r border-b border-blue-700">{h}</div>)}
                    </div>
                    <div className="grid grid-rows-auto">
                        {weeks.map((week, widx) => {
                            const weekEvents = calendarData.multiDayEvents.filter(e => e.start <= week[6] && e.end >= week[0]);
                            const maxLane = weekEvents.length > 0 ? Math.max(...weekEvents.map(e => e.lane)) + 1 : 0;
                            return (
                                <div key={widx} className="grid grid-cols-7 relative border-b border-slate-300 min-h-[130px]">
                                    {weekEvents.map(ev => {
                                        const sIdx = Math.max(0, Math.round((ev.start - week[0]) / 86400000));
                                        const eIdx = Math.min(6, Math.round((ev.end - week[0]) / 86400000));
                                        return (
                                            <div key={ev.id} className={`absolute text-[10px] p-1 rounded overflow-hidden text-ellipsis whitespace-nowrap font-bold shadow-md z-10 border border-black/5 ${ev.color}`}
                                                 style={{ top: `calc(2rem + ${ev.lane} * 1.5rem)`, left: `calc(${(100/7)*sIdx}% + 2px)`, width: `calc(${(100/7)*(eIdx-sIdx+1)}% - 4px)`, height: '1.35rem' }}>{ev.title}</div>
                                        );
                                    })}
                                    {week.map(date => {
                                        const key = formatDateKey(date);
                                        const data = calendarData.dayDataMap.get(key) || { date, events: [] };
                                        const isCurrent = date.getMonth() === month;
                                        return (
                                            <div key={key} onClick={() => onDayClick(data)} 
                                                 className={`border-r border-slate-300 flex flex-col p-1.5 transition-all duration-200 cursor-pointer ${isCurrent ? 'bg-gradient-to-br from-white to-slate-50' : 'bg-slate-100 text-slate-300'} hover:bg-blue-50/50`}>
                                                <div className={`text-sm font-bold w-7 h-7 flex items-center justify-center rounded-full mb-1 ${isToday(date) ? 'bg-gradient-to-b from-blue-500 to-blue-700 text-white shadow-lg' : isCurrent ? (date.getDay() === 0 ? 'text-red-500' : date.getDay() === 6 ? 'text-blue-500' : 'text-slate-700') : 'text-slate-300'}`}>
                                                    {date.getDate()}
                                                </div>
                                                <div style={{ height: `${maxLane * 1.5}rem` }} />
                                                {data.holiday && <div className="text-[10px] bg-red-100 text-red-700 px-1.5 py-0.5 rounded font-bold truncate mb-1 border border-red-200 shadow-sm">â— {data.holiday.name}</div>}
                                                {data.events.slice(0, 3).map((e, i) => <div key={i} className={`text-[10px] px-1.5 py-0.5 rounded font-medium truncate mb-0.5 border border-black/5 shadow-sm ${e.color}`}>{e.title}</div>)}
                                                {data.events.length > 3 && <div className="text-[9px] text-slate-400 font-bold pl-1">+ {data.events.length-3}ê°œ</div>}
                                                {data.teacherDuty && <div className="mt-auto pt-1 border-t text-[9px] text-slate-400 font-medium truncate text-center">{data.teacherDuty.teacher}</div>}
                                            </div>
                                        );
                                    })}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const DataUploadModal = ({ onDataLoaded, onClose }) => {
            const [name, setName] = useState(StorageManager.getSchoolName() || '');
            const [error, setError] = useState('');
            const [files, setFiles] = useState({ e: null, h: null, s: null, l: null });

            const handleFile = (e, type) => {
                const f = e.target.files[0]; if(!f) return;
                if(type === 'l') { const r = new FileReader(); r.onload = (ev) => setFiles(p => ({ ...p, l: ev.target.result })); r.readAsDataURL(f); return; }
                const isEx = f.name.toLowerCase().endsWith('.xlsx');
                const cb = (txt) => setFiles(p => ({ ...p, [type]: txt }));
                if(isEx) processExcelFile(f, cb, setError); else processCsvFile(f, cb, setError);
            };

            const submit = () => {
                if(!name.trim()) return setError('í•™êµëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                StorageManager.saveSchoolName(name);
                if(files.e) StorageManager.saveEvents(files.e);
                if(files.h) StorageManager.saveHolidays(files.h);
                if(files.s) StorageManager.saveSpecialEvents(files.s);
                if(files.l) StorageManager.saveLogo(files.l);
                onDataLoaded({ schoolName: name, events: files.e || StorageManager.getEvents(), holidays: files.h || StorageManager.getHolidays(), specialEvents: files.s || StorageManager.getSpecialEvents(), logo: files.l || StorageManager.getLogo() });
            };

            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex justify-center items-center p-4" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-6 overflow-y-auto max-h-[90vh]" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold mb-6">ë°ì´í„° ì„¤ì •</h2>
                        <div className="space-y-6">
                            <div className="bg-slate-50 p-4 rounded-lg border">
                                <label className="block text-sm font-bold mb-2">í•™êµ ì´ë¦„</label>
                                <input type="text" value={name} onChange={e => setName(e.target.value)} className="w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500" />
                                <label className="block text-sm font-bold mt-4 mb-2">ë¡œê³  ì´ë¯¸ì§€</label>
                                <input type="file" accept="image/*" onChange={e => handleFile(e, 'l')} className="w-full text-sm" />
                            </div>
                            <div className="bg-slate-50 p-4 rounded-lg border space-y-4">
                                <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">í•™ì‚¬ì¼ì •</label><input type="file" onChange={e => handleFile(e, 'e')} className="text-sm w-full" /></div>
                                <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">ê³µíœ´ì¼</label><input type="file" onChange={e => handleFile(e, 'h')} className="text-sm w-full" /></div>
                                <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">íŠ¹ë³„í–‰ì‚¬</label><input type="file" onChange={e => handleFile(e, 's')} className="text-sm w-full" /></div>
                            </div>
                            {error && <p className="text-red-500 text-sm font-bold">{error}</p>}
                            <div className="flex gap-2">
                                <button onClick={submit} className="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-md">ì €ì¥ ë° ì ìš©</button>
                                <button onClick={onClose} className="px-6 py-3 bg-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-300 transition-colors">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
